var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,o=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&i(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&i(e,r,t[r]);return e},l=(e,n)=>t(e,r(n));import{g as u,h as d,r as c,j as m}from"./vendor-niVxJDCj.js";import{B as f}from"./index-BuwQNYxn.js";import{D as h}from"./datetime-KvEPMH3x.js";import{a as x}from"./attendanceServices-EBbj2rkI.js";import{R as b,U as g,k as p,s as y,q as v,a as w,i as k}from"./ui-DVJ2orZe.js";var j={exports:{}};const N=u(j.exports=function(){var e=1e3,t=6e4,r=36e5,n="millisecond",s="second",a="minute",i="hour",o="day",l="week",u="month",d="quarter",c="year",m="date",f="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,x=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,b={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},g=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},p={s:g,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),n=Math.floor(r/60),s=r%60;return(t<=0?"+":"-")+g(n,2,"0")+":"+g(s,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),s=t.clone().add(n,u),a=r-s<0,i=t.clone().add(n+(a?-1:1),u);return+(-(n+(r-s)/(a?s-i:i-s))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:c,w:l,d:o,D:m,h:i,m:a,s:s,ms:n,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",v={};v[y]=b;var w="$isDayjsObject",k=function(e){return e instanceof $||!(!e||!e[w])},j=function e(t,r,n){var s;if(!t)return y;if("string"==typeof t){var a=t.toLowerCase();v[a]&&(s=a),r&&(v[a]=r,s=a);var i=t.split("-");if(!s&&i.length>1)return e(i[0])}else{var o=t.name;v[o]=t,s=o}return!n&&s&&(y=s),s||!n&&y},N=function(e,t){if(k(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new $(r)},S=p;S.l=j,S.i=k,S.w=function(e,t){return N(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var $=function(){function b(e){this.$L=j(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var g=b.prototype;return g.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(h);if(n){var s=n[2]-1||0,a=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],s,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)):new Date(n[1],s,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)}}return new Date(t)}(e),this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=function(){return S},g.isValid=function(){return!(this.$d.toString()===f)},g.isSame=function(e,t){var r=N(e);return this.startOf(t)<=r&&r<=this.endOf(t)},g.isAfter=function(e,t){return N(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<N(e)},g.$g=function(e,t,r){return S.u(e)?this[t]:this.set(r,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var r=this,n=!!S.u(t)||t,d=S.p(e),f=function(e,t){var s=S.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return n?s:s.endOf(o)},h=function(e,t){return S.w(r.toDate()[e].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},x=this.$W,b=this.$M,g=this.$D,p="set"+(this.$u?"UTC":"");switch(d){case c:return n?f(1,0):f(31,11);case u:return n?f(1,b):f(0,b+1);case l:var y=this.$locale().weekStart||0,v=(x<y?x+7:x)-y;return f(n?g-v:g+(6-v),b);case o:case m:return h(p+"Hours",0);case i:return h(p+"Minutes",1);case a:return h(p+"Seconds",2);case s:return h(p+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var r,l=S.p(e),d="set"+(this.$u?"UTC":""),f=(r={},r[o]=d+"Date",r[m]=d+"Date",r[u]=d+"Month",r[c]=d+"FullYear",r[i]=d+"Hours",r[a]=d+"Minutes",r[s]=d+"Seconds",r[n]=d+"Milliseconds",r)[l],h=l===o?this.$D+(t-this.$W):t;if(l===u||l===c){var x=this.clone().set(m,1);x.$d[f](h),x.init(),this.$d=x.set(m,Math.min(this.$D,x.daysInMonth())).$d}else f&&this.$d[f](h);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[S.p(e)]()},g.add=function(n,d){var m,f=this;n=Number(n);var h=S.p(d),x=function(e){var t=N(f);return S.w(t.date(t.date()+Math.round(e*n)),f)};if(h===u)return this.set(u,this.$M+n);if(h===c)return this.set(c,this.$y+n);if(h===o)return x(1);if(h===l)return x(7);var b=(m={},m[a]=t,m[i]=r,m[s]=e,m)[h]||1,g=this.$d.getTime()+n*b;return S.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||f;var n=e||"YYYY-MM-DDTHH:mm:ssZ",s=S.z(this),a=this.$H,i=this.$m,o=this.$M,l=r.weekdays,u=r.months,d=r.meridiem,c=function(e,r,s,a){return e&&(e[r]||e(t,n))||s[r].slice(0,a)},m=function(e){return S.s(a%12||12,e,"0")},h=d||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(x,(function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return S.s(t.$y,4,"0");case"M":return o+1;case"MM":return S.s(o+1,2,"0");case"MMM":return c(r.monthsShort,o,u,3);case"MMMM":return c(u,o);case"D":return t.$D;case"DD":return S.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return c(r.weekdaysMin,t.$W,l,2);case"ddd":return c(r.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(a);case"HH":return S.s(a,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return h(a,i,!0);case"A":return h(a,i,!1);case"m":return String(i);case"mm":return S.s(i,2,"0");case"s":return String(t.$s);case"ss":return S.s(t.$s,2,"0");case"SSS":return S.s(t.$ms,3,"0");case"Z":return s}return null}(e)||s.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(n,m,f){var h,x=this,b=S.p(m),g=N(n),p=(g.utcOffset()-this.utcOffset())*t,y=this-g,v=function(){return S.m(x,g)};switch(b){case c:h=v()/12;break;case u:h=v();break;case d:h=v()/3;break;case l:h=(y-p)/6048e5;break;case o:h=(y-p)/864e5;break;case i:h=y/r;break;case a:h=y/t;break;case s:h=y/e;break;default:h=y}return f?h:S.a(h)},g.daysInMonth=function(){return this.endOf(u).$D},g.$locale=function(){return v[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=j(e,t,!0);return n&&(r.$L=n),r},g.clone=function(){return S.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},b}(),D=$.prototype;return N.prototype=D,[["$ms",n],["$s",s],["$m",a],["$H",i],["$W",o],["$M",u],["$y",c],["$D",m]].forEach((function(e){D[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),N.extend=function(e,t){return e.$i||(e(t,$,N),e.$i=!0),N},N.locale=j,N.isDayjs=k,N.unix=function(e){return N(1e3*e)},N.en=v[y],N.Ls=v,N.p={},N}()),S=e=>{if(!e)return"N/A";try{if(e instanceof Date)return h.fromJSDate(e).setZone("Asia/Colombo").toLocaleString(h.TIME_WITH_SECONDS);const t=h.fromISO(e);return t.isValid?t.setZone("Asia/Colombo").toLocaleString(h.TIME_WITH_SECONDS):h.fromJSDate(new Date(e)).setZone("Asia/Colombo").toLocaleString(h.TIME_WITH_SECONDS)}catch(t){return"N/A"}},$=({title:e,count:t,total:r,icon:n})=>m.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 dark:from-gray-800 dark:to-gray-700 p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-blue-100 dark:border-gray-600 transform hover:-translate-y-1",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-blue-600 dark:text-blue-300",children:e}),m.jsxs("p",{className:"text-3xl font-bold text-blue-900 dark:text-white mt-2",children:[m.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:t}),void 0!==r&&m.jsxs("span",{className:"text-blue-400 dark:text-blue-400 text-lg ml-1",children:["/ ",r]})]})]}),m.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-blue-600 dark:from-blue-600 dark:to-blue-800 rounded-full text-white shadow-md",children:n})]})}),D=({students:e,loading:t})=>t?m.jsx("div",{className:"flex justify-center py-8",children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 dark:border-blue-400"})}):e&&0!==e.length?m.jsx("div",{className:"overflow-x-auto rounded-xl shadow-xl",children:m.jsxs("table",{className:"min-w-full divide-y divide-blue-100 dark:divide-gray-700",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"bg-gradient-to-r from-blue-600 to-blue-400 dark:from-blue-800 dark:to-blue-600",children:[m.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Student"}),m.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Index Number"}),m.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Email"}),m.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Status"}),m.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Entry Time"}),m.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Leave Time"})]})}),m.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-blue-50 dark:divide-gray-700",children:e.map(((e,t)=>{var r,n,s,a;return m.jsxs("tr",{className:(t%2==0?"bg-white dark:bg-gray-800":"bg-blue-50 dark:bg-gray-700")+" hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors duration-150",children:[m.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:m.jsx("span",{className:"text-blue-600 dark:text-blue-300 font-semibold",children:(null==(n=null==(r=e.name)?void 0:r.charAt(0))?void 0:n.toUpperCase())||"?"})}),m.jsx("div",{className:"ml-4",children:m.jsx("div",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:e.name||"N/A"})})]})}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-700 dark:text-blue-300 font-mono",children:e.indexNumber||"N/A"}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-500 dark:text-blue-400",children:e.student_email||e.email||"N/A"}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsx("span",{className:C(e.status),children:e.displayStatus||(null==(s=e.status)?void 0:s.charAt(0).toUpperCase())+(null==(a=e.status)?void 0:a.slice(1))||"Unknown"})}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-300",children:S(e.entryTime)}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-300",children:S(e.leaveTime)})]},e.uniqueKey)}))})]})}):m.jsx("div",{className:"text-center py-8 text-blue-500 dark:text-blue-400",children:"No students found for the selected date"}),C=e=>{switch((null==e?void 0:e.toLowerCase())||"unknown"){case"entered":case"present":return"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/70 text-green-800 dark:text-green-300";case"left":return"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/70 text-blue-800 dark:text-blue-300";case"late":return"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900/70 text-yellow-800 dark:text-yellow-300";case"absent":return"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900/70 text-red-800 dark:text-red-300";default:return"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300"}},M=({searchQuery:e,setSearchQuery:t,filterStatus:r,setFilterStatus:n})=>m.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[m.jsxs("div",{className:"relative flex-grow",children:[m.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:m.jsx("svg",{className:"h-5 w-5 text-gray-400 dark:text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),m.jsx("input",{type:"text",placeholder:"Search students...",value:e,onChange:e=>t(e.target.value),className:"flex-grow pl-10 px-4 py-2 w-full border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-blue-500 dark:focus:border-blue-400 dark:bg-gray-700 dark:text-white transition-colors"})]}),m.jsxs("select",{value:r,onChange:e=>n(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-blue-500 dark:focus:border-blue-400 dark:bg-gray-700 dark:text-white bg-white appearance-none pr-8 transition-colors",style:{backgroundImage:"url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1.5em 1.5em"},children:[m.jsx("option",{value:"all",children:"All Statuses"}),m.jsx("option",{value:"present",children:"Present"}),m.jsx("option",{value:"absent",children:"Absent"}),m.jsx("option",{value:"left",children:"Left"}),m.jsx("option",{value:"late",children:"Late"})]})]}),T=({selectedDate:e,setSelectedDate:t,isValidDate:r})=>{const n=h.now().toFormat("yyyy-MM-dd"),s=h.fromJSDate(e).toFormat("yyyy-MM-dd");return m.jsxs("div",{className:"flex-grow max-w-xs",children:[m.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select Date"}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:m.jsx(w,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),m.jsx("input",{type:"date",id:"date",value:s,onChange:e=>{const r=new Date(e.target.value);isNaN(r.getTime())||t(r)},max:n,className:`w-full pl-10 px-3 py-2 border ${r?"border-gray-300 dark:border-gray-600":"border-red-300 dark:border-red-700"} rounded-lg focus:ring-2 ${r?"focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400":"focus:ring-red-500 focus:border-red-500 dark:focus:ring-red-400 dark:focus:border-red-400"} dark:bg-gray-700 dark:text-white`}),!r&&m.jsx("div",{className:"absolute right-0 top-0 h-full flex items-center pr-3 text-red-500 dark:text-red-400",children:m.jsx(k,{className:"h-5 w-5"})})]}),!r&&m.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:"Cannot select a future date"})]})},O=({error:e,onRetry:t})=>m.jsx("div",{className:"bg-white rounded-xl shadow-xl p-8 text-center",children:m.jsxs("div",{className:"flex flex-col items-center justify-center",children:[m.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:m.jsx(k,{className:"w-8 h-8 text-red-500"})}),m.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"network"===e.type?"Connection Error":"Server Error"}),m.jsx("p",{className:"text-gray-600 mb-6 max-w-md",children:"network"===e.type?"Unable to connect to the server. Please check your internet connection and try again.":"We encountered an error while fetching attendance data. Our team has been notified."}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[m.jsxs("button",{onClick:t,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[m.jsx(b,{className:"w-5 h-5 mr-2"}),"Try Again"]}),m.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Refresh Page"})]})]})}),_=()=>{const[e,t]=c.useState(new Date),[r,n]=c.useState([]),[s,a]=c.useState({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0}),[i,u]=c.useState(!1),[d,w]=c.useState(null),[k,j]=c.useState(""),[S,C]=c.useState("all"),_=c.useRef(null),A=c.useMemo((()=>{const t=new Date;t.setHours(0,0,0,0);const r=new Date(e);return r.setHours(0,0,0,0),r<=t}),[e]),L=c.useMemo((()=>r&&0!==r.length?r.filter((e=>{var t,r,n;const s=((null==(t=e.name)?void 0:t.toLowerCase())||"").includes(k.toLowerCase())||((null==(r=e.indexNumber)?void 0:r.toLowerCase())||"").includes(k.toLowerCase())||((null==(n=e.student_email)?void 0:n.toLowerCase())||"").includes(k.toLowerCase()),a="all"===S||e.status===S;return s&&a})):[]),[r,k,S]),I=c.useCallback(((...t)=>{return r=void 0,s=[...t],i=function*(t=e){var r,s,i;if(!A)return n([]),void a({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0});try{u(!0),w(null);const e=N(t).format("YYYY-MM-DD"),s=yield x.getAttendanceByDate(e),i=yield x.getTodayAttendance();if(!s||!s.data)throw new Error("Invalid response from server");const d=s.data.data;if(!d||!d.students)return n([]),void a({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0});const c={};(null==(r=null==i?void 0:i.data)?void 0:r.students)&&i.data.students.forEach((e=>{const t=e._id||e.id;t&&(c[t]=e)}));let{students:m,stats:f}=d;if(!m||0===m.length)return n([]),void a({totalStudents:(null==f?void 0:f.totalCount)||0,presentCount:(null==f?void 0:f.presentCount)||0,leftCount:(null==f?void 0:f.leftCount)||0,absentCount:(null==f?void 0:f.absentCount)||0,lateCount:(null==f?void 0:f.lateCount)||0});const b=m.map((e=>{var r,n,s,a;const i=e._id||e.id,u=i&&c[i]?c[i]:e,d=null==(r=e.attendanceHistory)?void 0:r.find((e=>{if(!e.date)return!1;const r=new Date(e.date),n=new Date(t);return r.toDateString()===n.toDateString()})),m=!d&&(null==(n=u.attendanceHistory)?void 0:n.find((e=>{if(!e.date)return!1;const r=new Date(e.date),n=new Date(t);return r.toDateString()===n.toDateString()}))),f=d||m;let x=null,b=null;if(null==f?void 0:f.entryTime)try{const e=h.fromISO(f.entryTime);e.isValid&&(x=e.toJSDate())}catch(v){}if(null==f?void 0:f.leaveTime)try{const e=h.fromISO(f.leaveTime);e.isValid&&(b=e.toJSDate())}catch(v){}const g=(null==f?void 0:f.status)||e.status;let p,y=(null==g?void 0:g.toLowerCase())||"unknown";switch(y){case"entered":p="Present",y="present";break;case"left":p="Left";break;case"late":p="Late";break;case"absent":p="Absent";break;default:p=(null==g?void 0:g.charAt(0).toUpperCase())+(null==g?void 0:g.slice(1))||"Unknown",y="unknown"}return l(o({},e),{id:e.id||e._id,indexNumber:(null==(s=e.indexNumber)?void 0:s.toUpperCase())||(null==(a=u.indexNumber)?void 0:a.toUpperCase())||"N/A",student_email:e.email||e.student_email||u.email||u.student_email||"N/A",status:y,displayStatus:p,entryTime:x,leaveTime:b,timestamp:e.timestamp||e.updatedAt||u.timestamp||u.updatedAt||(new Date).toISOString()})})),g={};b.forEach((e=>{const r=e.indexNumber;if(!g[r])return void(g[r]=l(o({},e),{uniqueKey:`student-${r}-${t.getTime()}`}));const n=g[r];e.entryTime&&(!n.entryTime||e.entryTime instanceof Date&&n.entryTime instanceof Date&&e.entryTime>n.entryTime||new Date(e.entryTime)>new Date(n.entryTime))&&(n.entryTime=e.entryTime),e.leaveTime&&(!n.leaveTime||e.leaveTime instanceof Date&&n.leaveTime instanceof Date&&e.leaveTime>n.leaveTime||new Date(e.leaveTime)>new Date(n.leaveTime))&&(n.leaveTime=e.leaveTime),e.timestamp&&(!n.timestamp||new Date(e.timestamp)>new Date(n.timestamp))&&(n.status=e.status,n.displayStatus=e.displayStatus,n.timestamp=e.timestamp)}));const p=Object.values(g),y=p.sort(((e,t)=>{const r={entered:1,present:1,left:2,late:3,absent:4},n=(r[e.status]||5)-(r[t.status]||5);return 0!==n?n:e.indexNumber.localeCompare(t.indexNumber)}));n(y);const v=p.filter((e=>"entered"===e.status||"present"===e.status)).length,k=p.filter((e=>"left"===e.status)).length,j=p.filter((e=>"absent"===e.status)).length,S=p.filter((e=>"late"===e.status)).length;a({totalStudents:(null==f?void 0:f.totalCount)||p.length,presentCount:(null==f?void 0:f.presentCount)||v,leftCount:(null==f?void 0:f.leftCount)||k,absentCount:(null==f?void 0:f.absentCount)||j,lateCount:(null==f?void 0:f.lateCount)||S})}catch(d){const e="Network Error"!==d.message&&d.response?"server":"network";w({type:e,message:d.message||"An unexpected error occurred",details:(null==(i=null==(s=d.response)?void 0:s.data)?void 0:i.message)||"Please try again later"}),n([]),a({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0}),_.current!==e&&(_.current=e,f.error("network"===e?"Connection error. Please check your internet connection.":"Failed to load attendance data. Please try again.",{onClose:()=>{_.current=null}}))}finally{u(!1)}},new Promise(((e,t)=>{var n=e=>{try{o(i.next(e))}catch(r){t(r)}},a=e=>{try{o(i.throw(e))}catch(r){t(r)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,a);o((i=i.apply(r,s)).next())}));var r,s,i}),[e,A]);c.useEffect((()=>{I()}),[e,I]);const H=h.fromJSDate(e).toFormat("MMMM d, yyyy");return m.jsx("div",{className:"container mx-auto px-4 py-8 bg-transparent min-h-screen dark:bg-gray-900",children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[m.jsxs("h1",{className:"text-3xl font-bold text-blue-900 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-blue-800 dark:from-blue-400 dark:to-blue-600",children:["Attendance for ",H]}),m.jsxs("div",{className:"flex flex-col md:flex-row gap-4 w-[200px] md:w-auto",children:[m.jsx(T,{selectedDate:e,setSelectedDate:t,isValidDate:A}),m.jsx("button",{onClick:()=>{I(),f.info("Refreshing attendance data...")},disabled:!A||i,className:`w-full md:w-auto mt-auto inline-flex items-center justify-center px-4 py-2 h-10 self-end ${!A||i?"bg-gray-300 dark:bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-500 dark:from-blue-700 dark:to-blue-600 hover:from-blue-700 hover:to-blue-600 dark:hover:from-blue-800 dark:hover:to-blue-700"} text-white rounded-lg focus:ring-4 focus:ring-blue-500 dark:focus:ring-blue-400 focus:outline-none transition-all duration-200 shadow-md`,children:i?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"animate-spin h-5 w-5 mr-2 border-2 border-white border-t-transparent rounded-full"}),"Loading..."]}):m.jsxs(m.Fragment,{children:[m.jsx(b,{className:"w-5 h-5 mr-2"}),"Refresh"]})})]})]}),d?m.jsx(O,{error:d,onRetry:()=>{w(null),I()}}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[m.jsx($,{title:"Total Students",count:s.totalStudents,icon:m.jsx(g,{className:"w-6 h-6"})}),m.jsx($,{title:"Present",count:s.presentCount,total:s.totalStudents,icon:m.jsx(p,{className:"w-6 h-6"})}),m.jsx($,{title:"Left",count:s.leftCount,total:s.totalStudents,icon:m.jsx(y,{className:"w-6 h-6"})}),m.jsx($,{title:"Absent",count:s.absentCount,total:s.totalStudents,icon:m.jsx(v,{className:"w-6 h-6"})})]}),m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 mb-8",children:[m.jsx(M,{searchQuery:k,setSearchQuery:j,filterStatus:S,setFilterStatus:C}),m.jsx(D,{students:L,loading:i})]})]})]})})};export{_ as default};
