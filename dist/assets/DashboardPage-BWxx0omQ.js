var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;import{r as o,j as d}from"./vendor-niVxJDCj.js";import{D as i}from"./datetime-KvEPMH3x.js";import{a as u}from"./attendanceServices-EBbj2rkI.js";import{q as c,k as m,r as x,s as b,U as h,t as f,u as g}from"./ui-DVJ2orZe.js";import"./index-BuwQNYxn.js";const j=e=>{if(!e)return"-";try{if(e instanceof Date)return i.fromJSDate(e).setZone("Asia/Colombo").toLocaleString(i.TIME_WITH_SECONDS);const t=i.fromISO(e);return t.isValid?t.setZone("Asia/Colombo").toLocaleString(i.TIME_WITH_SECONDS):i.fromJSDate(new Date(e)).setZone("Asia/Colombo").toLocaleString(i.TIME_WITH_SECONDS)}catch(t){return"-"}},p=e=>{if(!e)return"px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";const t="px-2.5 py-0.5 rounded-full text-xs font-medium",r=e.toLowerCase();return"present"===r||"entered"===r?`${t} bg-gradient-to-r from-green-100 to-green-200 dark:from-green-800 dark:to-green-900 text-green-800 dark:text-green-100`:"left"===r?`${t} bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-900 text-blue-800 dark:text-blue-100`:"late"===r?`${t} bg-gradient-to-r from-yellow-100 to-yellow-200 dark:from-yellow-800 dark:to-yellow-900 text-yellow-800 dark:text-yellow-100`:"absent"===r?`${t} bg-gradient-to-r from-red-100 to-red-200 dark:from-red-800 dark:to-red-900 text-red-800 dark:text-red-100`:`${t} bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200`},v=({title:e,count:t,total:r,color:s,icon:a})=>d.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 dark:from-slate-800 dark:to-slate-900 p-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border border-blue-100 dark:border-slate-700",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:e}),d.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:[d.jsx("span",{className:`text-${s}-600 dark:text-${s}-400`,children:t}),void 0!==r&&d.jsxs("span",{className:"text-gray-400 dark:text-gray-500 text-lg ml-1",children:["/ ",r]})]})]}),d.jsx("div",{className:`p-3.5 rounded-full bg-gradient-to-br from-${s}-400 to-${s}-500 dark:from-${s}-600 dark:to-${s}-700 text-white`,children:a})]})}),y=({searchQuery:e,setSearchQuery:t,activeTab:r,setActiveTab:s})=>d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[d.jsxs("div",{className:"relative flex-grow",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(f,{className:"h-5 w-5 text-blue-400"})}),d.jsx("input",{type:"text",placeholder:"Search students...",value:e,onChange:e=>t(e.target.value),className:"pl-10 w-full px-4 py-2 border border-blue-200 dark:border-blue-800 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-slate-800 dark:text-white shadow-sm"})]}),d.jsxs("div",{className:"flex bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-800",children:[d.jsx("button",{onClick:()=>s("present"),className:"px-4 py-2 rounded-l-lg transition-colors duration-150 "+("present"===r?"bg-blue-500 text-white font-medium":"text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"),children:"Present"}),d.jsx("button",{onClick:()=>s("left"),className:"px-4 py-2 rounded-r-lg transition-colors duration-150 "+("left"===r?"bg-blue-500 text-white font-medium":"text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"),children:"Left"})]})]}),w=()=>{const[e,t]=o.useState(i.now().setZone("Asia/Colombo"));return o.useEffect((()=>{const e=setInterval((()=>{t(i.now().setZone("Asia/Colombo"))}),1e3);return()=>clearInterval(e)}),[]),d.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-slate-700",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Current Time"}),d.jsx(x,{className:"h-5 w-5 text-blue-500"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2",children:e.toFormat("hh:mm:ss a")}),d.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.toFormat("EEEE, MMMM d, yyyy")})]})]})},N=({presentCount:e,leftCount:t})=>{const r=e+t,s=r>0?Math.round(e/r*100):0,a=r>0?Math.round(t/r*100):0;return d.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-slate-700",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Attendance Distribution"}),d.jsx(g,{className:"h-5 w-5 text-blue-500"})]}),d.jsx("div",{className:"flex items-center justify-center mb-4",children:d.jsx("div",{className:"w-32 h-32 rounded-full border-8 border-blue-500 dark:border-blue-600 relative",children:d.jsx("div",{className:"absolute inset-0 rounded-full border-8 border-green-500 dark:border-green-600",style:{clipPath:`polygon(50% 50%, 50% 0%, ${s>25?"100% 0%":`${50+50*Math.sin(2*Math.PI*s/100)}% ${50-50*Math.cos(2*Math.PI*s/100)}%`})`,transform:`rotate(${s>25?0:-90}deg)`}})})}),d.jsxs("div",{className:"flex justify-around",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"inline-block w-3 h-3 bg-green-500 rounded-full mr-1"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Present"}),d.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[e," (",s,"%)"]})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"inline-block w-3 h-3 bg-blue-500 rounded-full mr-1"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Left"}),d.jsxs("p",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:[t," (",a,"%)"]})]})]})]})},k=({student:e})=>{var t;return d.jsxs("div",{className:"flex items-start space-x-4 p-4 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors duration-150",children:[d.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 rounded-full flex items-center justify-center text-white font-medium shadow-md",children:e.name.substring(0,1)}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex justify-between items-start",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),d.jsx("span",{className:p(e.status),children:e.displayStatus})]}),d.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mt-1",children:[d.jsx("span",{className:"font-mono",children:e.indexNumber}),d.jsx("span",{className:"mx-2",children:"â€¢"}),d.jsxs("div",{className:"flex items-center",children:[(e=>{if(!e)return d.jsx(x,{className:"h-4 w-4 text-gray-400"});const t=e.toLowerCase();return"present"===t||"entered"===t?d.jsx(m,{className:"h-4 w-4 text-green-500"}):"left"===t?d.jsx(b,{className:"h-4 w-4 text-blue-500"}):d.jsx(x,{className:"h-4 w-4 text-gray-400"})})(e.status),d.jsx("span",{className:"ml-1",children:"left"===(null==(t=e.status)?void 0:t.toLowerCase())?j(e.leaveTime):j(e.entryTime)})]})]})]})]})},C=({students:e,loading:t,activeTab:r})=>{if(t)return d.jsx("div",{className:"flex justify-center py-8",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 dark:border-blue-700 border-t-blue-600 dark:border-t-blue-400"})});if(!e.length){const e="present"===r?"No students currently present":"No students have left yet",t="present"===r?"Students will appear here when they check in":"Students who leave will appear here",s="present"===r?d.jsx(m,{className:"mx-auto h-12 w-12 text-green-300 dark:text-green-700"}):d.jsx(b,{className:"mx-auto h-12 w-12 text-blue-300 dark:text-blue-700"});return d.jsxs("div",{className:"text-center py-16 bg-gradient-to-b from-white to-blue-50 dark:from-slate-800 dark:to-slate-900 rounded-lg border border-blue-100 dark:border-blue-900",children:[s,d.jsx("p",{className:"mt-4 text-blue-600 dark:text-blue-400 font-medium",children:e}),d.jsx("p",{className:"text-blue-400 dark:text-blue-500 text-sm mt-1",children:t})]})}const s="present"===r?"Present Students":"Left Students",a="present"===r?d.jsx(m,{className:"h-5 w-5 text-green-500"}):d.jsx(b,{className:"h-5 w-5 text-blue-500"});return d.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-gray-200 dark:border-slate-700",children:[d.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:s}),a]}),d.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700 max-h-[500px] overflow-y-auto",children:e.map((e=>d.jsx(k,{student:e},e.uniqueKey)))})]})},S=()=>{const[e,i]=o.useState({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0}),[x,f]=o.useState([]),[g,j]=o.useState(!1),[p,k]=o.useState(null),[S,T]=o.useState(""),[L,$]=o.useState("present"),A=o.useCallback((()=>{return e=void 0,o=null,d=function*(){try{j(!0),k(null);const e=yield u.getTodayAttendance();if(!e||!e.data)return f([]),i({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0}),void j(!1);const{students:o,totalCount:d,presentCount:c,absentCount:m,lateCount:x}=e.data;if(!o||0===o.length)return f([]),i({totalStudents:d||0,presentCount:c||0,leftCount:0,absentCount:m||0,lateCount:x||0}),void j(!1);const b=o.map((e=>{const o=e._id||e.id||Math.random().toString(36).substring(7);try{let u=null;const c=(new Date).toISOString().split("T")[0];(null==e?void 0:e.attendanceHistory)&&Array.isArray(e.attendanceHistory)&&(u=e.attendanceHistory.find((e=>e.date&&e.date.startsWith(c))));let m=null,x=null;u&&(m=u.entryTime,x=u.leaveTime);let b=e.status,h=e.status;if(u&&(h=u.status,h)){const e=h.toLowerCase();b="entered"===e?"Present":"left"===e?"Left":h.charAt(0).toUpperCase()+h.slice(1)}const f=e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.name||"Unknown Student",g=e.student_email||e.email||null;return d=((e,t)=>{for(var r in t||(t={}))a.call(t,r)&&n(e,r,t[r]);if(s)for(var r of s(t))l.call(t,r)&&n(e,r,t[r]);return e})({},e),i={uniqueKey:o,name:f,email:g,student_email:e.student_email,displayStatus:b,status:h,entryTime:m,leaveTime:x,timestamp:m?new Date(m).getTime():0},t(d,r(i))}catch(u){return{uniqueKey:o,name:e.name||e.firstName||"Unknown Student",indexNumber:e.indexNumber||"N/A",status:e.status||"Unknown",displayStatus:e.status||"Unknown",entryTime:null,leaveTime:null,timestamp:0,_id:e._id||e.id}}var d,i})),h=b.filter((e=>{var t;const r=null==(t=e.status)?void 0:t.toLowerCase();return"present"===r||"entered"===r})),g=b.filter((e=>{var t;return"left"===(null==(t=e.status)?void 0:t.toLowerCase())})),p=h.sort(((e,t)=>t.timestamp-e.timestamp)),v=g.sort(((e,t)=>{const r=e.leaveTime?new Date(e.leaveTime).getTime():0;return(t.leaveTime?new Date(t.leaveTime).getTime():0)-r})),y=[...p,...v];f(y),i({totalStudents:d||0,presentCount:h.length||0,leftCount:g.length||0,absentCount:m||0,lateCount:x||0})}catch(e){k("Failed to load dashboard data"),f([]),i({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0})}finally{j(!1)}},new Promise(((t,r)=>{var s=e=>{try{l(d.next(e))}catch(t){r(t)}},a=e=>{try{l(d.throw(e))}catch(t){r(t)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,a);l((d=d.apply(e,o)).next())}));var e,o,d}),[]),D=o.useMemo((()=>x.filter((e=>{var t,r,s,a;const l=null==(t=e.status)?void 0:t.toLowerCase(),n="present"===L?"present"===l||"entered"===l:"left"===l,o=((null==(r=e.name)?void 0:r.toLowerCase())||"").includes(S.toLowerCase())||((null==(s=e.indexNumber)?void 0:s.toLowerCase())||"").includes(S.toLowerCase())||((null==(a=e.student_email)?void 0:a.toLowerCase())||"").includes(S.toLowerCase());return n&&o}))),[x,L,S]),I={total:d.jsx(h,{className:"h-6 w-6 text-white"}),present:d.jsx(m,{className:"h-6 w-6 text-white"}),left:d.jsx(b,{className:"h-6 w-6 text-white"}),absent:d.jsx(c,{className:"h-6 w-6 text-white"})};o.useEffect((()=>{A();const e=setInterval(A,3e4);return()=>clearInterval(e)}),[A]);const M=e.presentCount>0||e.leftCount>0;return d.jsx("div",{className:"min-h-screen bg-transparent",children:d.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-8",children:[d.jsx("h1",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-blue-800",children:"Attendance Dashboard"}),d.jsx(w,{})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10",children:[d.jsx(v,{title:"Total Students",count:e.totalStudents,color:"blue",icon:I.total}),d.jsx(v,{title:"Present",count:e.presentCount,total:e.totalStudents,color:"green",icon:I.present}),d.jsx(v,{title:"Left",count:e.leftCount,total:e.totalStudents,color:"blue",icon:I.left}),d.jsx(v,{title:"Absent",count:e.absentCount,total:e.totalStudents,color:"red",icon:I.absent})]}),p&&d.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-md",children:d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"flex-shrink-0",children:d.jsx(c,{className:"h-5 w-5 text-red-400"})}),d.jsx("div",{className:"ml-3",children:d.jsx("p",{className:"text-sm text-red-700",children:p})})]})}),M?d.jsxs(d.Fragment,{children:[d.jsx(y,{searchQuery:S,setSearchQuery:T,activeTab:L,setActiveTab:$}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[d.jsx(N,{presentCount:e.presentCount,leftCount:e.leftCount}),d.jsx(C,{students:D,loading:g,activeTab:L})]})]}):d.jsxs("div",{className:"text-center py-16 bg-gradient-to-b from-white to-blue-50 dark:from-slate-800 dark:to-slate-900 rounded-xl shadow-lg border border-blue-100 dark:border-blue-900 mb-6",children:[d.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:d.jsx(m,{className:"h-10 w-10 text-blue-500 dark:text-blue-400"})}),d.jsx("h3",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:"No Activity Yet"}),d.jsx("p",{className:"text-blue-400 dark:text-blue-500 text-sm mt-1 max-w-md mx-auto",children:"The dashboard will display attendance information when students start checking in."})]})]})})};export{S as default};
