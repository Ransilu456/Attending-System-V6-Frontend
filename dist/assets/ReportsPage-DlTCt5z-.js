var e=(e,t,a)=>new Promise(((r,s)=>{var d=e=>{try{n(a.next(e))}catch(t){s(t)}},i=e=>{try{n(a.throw(e))}catch(t){s(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(d,i);n((a=a.apply(e,t)).next())}));import{j as t,m as a,r,A as s}from"./vendor-niVxJDCj.js";import{u as d,B as i}from"./index-BuwQNYxn.js";import{D as n}from"./datetime-KvEPMH3x.js";import{c as l}from"./react-datepicker-CsiE6Dym.js";import{i as o,m as c,a as x,B as m,F as u,C as g,x as y,U as h,D as p}from"./ui-DVJ2orZe.js";import{a as b,r as f}from"./attendanceServices-EBbj2rkI.js";const k=e=>{if(!e)return"N/A";try{if("object"==typeof e&&e.$date){if(e.$date.$numberLong){const t=parseInt(e.$date.$numberLong);return n.fromMillis(t).setZone("Asia/Colombo").toLocaleString(n.TIME_WITH_SECONDS)}if("string"==typeof e.$date)return n.fromISO(e.$date).setZone("Asia/Colombo").toLocaleString(n.TIME_WITH_SECONDS)}if("object"==typeof e&&e.$$date)return n.fromMillis(e.$$date).setZone("Asia/Colombo").toLocaleString(n.TIME_WITH_SECONDS);if(e instanceof Date)return n.fromJSDate(e).setZone("Asia/Colombo").toLocaleString(n.TIME_WITH_SECONDS);if("string"==typeof e){const t=n.fromISO(e);if(t.isValid)return t.setZone("Asia/Colombo").toLocaleString(n.TIME_WITH_SECONDS)}if("number"==typeof e)return n.fromMillis(e).setZone("Asia/Colombo").toLocaleString(n.TIME_WITH_SECONDS);const t=new Date(e);return isNaN(t.getTime())?"N/A":n.fromJSDate(t).setZone("Asia/Colombo").toLocaleString(n.TIME_WITH_SECONDS)}catch(t){return"N/A"}},w=e=>{if(!e)return"N/A";try{if("object"==typeof e&&e.$date){if(e.$date.$numberLong){const t=parseInt(e.$date.$numberLong);return n.fromMillis(t).setZone("Asia/Colombo").toLocaleString(n.DATE_MED)}if("string"==typeof e.$date)return n.fromISO(e.$date).setZone("Asia/Colombo").toLocaleString(n.DATE_MED)}if(e instanceof Date)return n.fromJSDate(e).setZone("Asia/Colombo").toLocaleString(n.DATE_MED);if("string"==typeof e){const t=n.fromISO(e);if(t.isValid)return t.setZone("Asia/Colombo").toLocaleString(n.DATE_MED)}if("number"==typeof e)return n.fromMillis(e).setZone("Asia/Colombo").toLocaleString(n.DATE_MED);const t=new Date(e);return isNaN(t.getTime())?"N/A":n.fromJSDate(t).setZone("Asia/Colombo").toLocaleString(n.DATE_MED)}catch(t){return"N/A"}},N=({reportType:e,previewData:r,loading:s,error:d,selectedDate:i})=>{if(s)return t.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:[t.jsx(a.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"rounded-full h-10 w-10 border-b-2 border-blue-500 dark:border-blue-400 mx-auto"}),t.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300",children:"Loading preview data..."})]});if(d)return t.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 dark:border-red-500 p-4 rounded-md shadow-md",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(o,{className:"h-5 w-5 text-red-400 dark:text-red-500"})}),t.jsx("div",{className:"ml-3",children:t.jsx("p",{className:"text-sm text-red-600 dark:text-red-300",children:d.message||"Failed to load preview data"})})]})});if(!r||!r.students&&!r.student&&!r.data&&!r.attendanceRecords&&!Array.isArray(r)&&Array.isArray(r)&&0===r.length)return t.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8 text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-slate-800/50 rounded-lg p-6 shadow-sm",children:t.jsx("p",{children:"No preview data available. Generate a preview to see report data."})});return t.jsxs("div",{className:"mt-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center",children:[t.jsx(c,{className:"h-5 w-5 mr-2 text-blue-500 dark:text-blue-400"}),"Report Preview",t.jsxs("span",{className:"ml-2 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-1 rounded-full",children:[(()=>{var t;if("daily"===e){const e=r.data||r.students||r;return Array.isArray(e)?e.length:0}return"weekly"===e||"monthly"===e?(r.students||[]).length:"individual"===e?((null==(t=r.student)?void 0:t.attendanceRecords)||[]).length:0})()," Records"]})]}),t.jsx("div",{className:"overflow-x-auto rounded-lg shadow border border-gray-200 dark:border-slate-700",children:t.jsxs("table",{className:"min-w-full",children:[t.jsx("thead",{className:"bg-gradient-to-r from-blue-600 to-blue-500 dark:from-blue-600 dark:to-blue-500",children:(()=>{switch(e){case"daily":return t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Name"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Index Number"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Entry Time"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Leave Time"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Duration"})]});case"weekly":return t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Name"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Index Number"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Days Present"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Days Absent"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Attendance Rate"})]});case"monthly":return t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Name"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Index Number"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Month"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Days Present"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Days Absent"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Attendance Rate"})]});case"individual":return t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Entry Time"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Leave Time"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Duration"})]});default:return t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Name"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Index Number"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-white dark:text-white uppercase tracking-wider",children:"Status"})]})}})()}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:(()=>{if("daily"===e){const e=r.data||r.students||r;return e&&Array.isArray(e)&&0!==e.length?e.map(((e,a)=>{let r=null;if(e.attendanceHistory&&e.attendanceHistory.length>0){const t=w(i),a=e.attendanceHistory.filter((e=>w(new Date(e.date))===t));a.length>0&&(r=a[a.length-1])}const s=r?"entered"===r.status?"Present":"left"===r.status?"Left":"late"===r.status?"Late":"Absent":e.status,d=r?r.entryTime:e.entryTime,n=r?r.leaveTime:e.leaveTime;return t.jsxs("tr",{className:a%2==0?"bg-white dark:bg-slate-800":"bg-gray-50 dark:bg-slate-700",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.name||"N/A"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.indexNumber||"N/A"}),t.jsx("td",{className:"px-4 py-3 text-sm",children:t.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("Present"===s?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"Left"===s?"bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-300":"Absent"===s?"bg-red-100 text-red-800 dark:bg-red-800/30 dark:text-red-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:s||"Unknown"})}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:k(d)}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:k(n)}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:d&&n?l(d,n):"N/A"})]},`daily-${a}`)})):t.jsx("tr",{children:t.jsx("td",{colSpan:"6",className:"px-4 py-3 text-center text-gray-500 dark:text-gray-400",children:"No data available for selected date"})})}if("weekly"===e){let e=[];return r.students&&Array.isArray(r.students)?e=r.students:r.data&&Array.isArray(r.data)?e=r.data:Array.isArray(r)&&(e=r),0===e.length?t.jsx("tr",{children:t.jsx("td",{colSpan:"5",className:"px-4 py-3 text-center text-gray-500 dark:text-gray-400",children:"No data available for selected date range"})}):e.map(((e,a)=>t.jsxs("tr",{className:a%2==0?"bg-white dark:bg-slate-800":"bg-gray-50 dark:bg-slate-700",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.name||"N/A"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.indexNumber||"N/A"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.daysPresent||0}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.daysAbsent||0}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:"number"==typeof e.attendanceRate?`${e.attendanceRate.toFixed(1)}%`:"N/A"})]},`weekly-${a}`)))}if("monthly"===e){let e=[];return r.students&&Array.isArray(r.students)?e=r.students:r.data&&Array.isArray(r.data)?e=r.data:Array.isArray(r)&&(e=r),0===e.length?t.jsx("tr",{children:t.jsx("td",{colSpan:"6",className:"px-4 py-3 text-center text-gray-500 dark:text-gray-400",children:"No data available for selected date range"})}):e.map(((e,a)=>t.jsxs("tr",{className:a%2==0?"bg-white dark:bg-slate-800":"bg-gray-50 dark:bg-slate-700",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.name||"N/A"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.indexNumber||"N/A"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.month||"N/A"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.daysPresent||0}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.daysAbsent||0}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:"number"==typeof e.attendanceRate?`${e.attendanceRate.toFixed(1)}%`:"N/A"})]},`monthly-${a}`)))}if("individual"===e){let e=[];return r.student&&Array.isArray(r.student.attendanceRecords)?e=r.student.attendanceRecords:r.data&&Array.isArray(r.data)?e=r.data:r.attendanceRecords&&Array.isArray(r.attendanceRecords)?e=r.attendanceRecords:Array.isArray(r)&&(e=r),0===e.length?t.jsx("tr",{children:t.jsx("td",{colSpan:"5",className:"px-4 py-3 text-center text-gray-500 dark:text-gray-400",children:"No data available for selected student"})}):e.map(((e,a)=>t.jsxs("tr",{className:a%2==0?"bg-white dark:bg-slate-800":"bg-gray-50 dark:bg-slate-700",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:w(e.date)}),t.jsx("td",{className:"px-4 py-3 text-sm",children:t.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("Present"===e.status?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"Left"===e.status?"bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-300":"Absent"===e.status?"bg-red-100 text-red-800 dark:bg-red-800/30 dark:text-red-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:e.status||"Unknown"})}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:k(e.entryTime)}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:k(e.leaveTime)}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100",children:e.entryTime&&e.leaveTime?l(e.entryTime,e.leaveTime):"N/A"})]},`individual-${a}`)))}return t.jsx("tr",{children:t.jsx("td",{colSpan:"6",className:"px-4 py-3 text-center text-gray-500 dark:text-gray-400",children:"No data available"})})})()})]})})]})},j=({icon:e,title:r,description:s,isSelected:d,onClick:i})=>t.jsxs(a.div,{onClick:i,whileHover:{y:-4,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},whileTap:{scale:.98},className:"flex flex-col p-5 border-2 rounded-lg cursor-pointer transition-all duration-200 "+(d?"border-blue-500 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 shadow-md dark:shadow-blue-900/20":"border-gray-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700 bg-white dark:bg-slate-800"),children:[t.jsx("div",{className:"p-3 rounded-full self-start "+(d?"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400":"bg-gray-100 dark:bg-slate-700 text-gray-500 dark:text-gray-400"),children:e}),t.jsx("h3",{className:"font-medium mt-3 "+(d?"text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-white"),children:r}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:s})]}),v=e=>{if(!e)return"";try{return n.fromJSDate(new Date(e)).toFormat("yyyy-MM-dd")}catch(t){return""}},D=({reportType:e,selectedDate:a,setSelectedDate:r,startDate:s,setStartDate:i,endDate:n,setEndDate:l})=>{const{theme:o}=d(),c=new Date,m=v(c),u=c.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"});return"daily"===e?t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Date"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),t.jsx("input",{type:"date",value:v(a),onChange:e=>{e.target.value&&r(new Date(e.target.value))},max:m,className:"w-full p-2 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 bg-white dark:bg-slate-700 text-gray-700 dark:text-white transition-colors duration-200"})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Please select a date not in the future. Today is ",u,"."]})]}):"weekly"===e||"monthly"===e?t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"weekly"===e?"Select Week Range":"Select Month Range"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"From"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),t.jsx("input",{type:"date",value:v(s),onChange:e=>{if(e.target.value){const t=new Date(e.target.value);i(t);new Date(n)<t&&l(t)}},max:m,className:"w-full p-2 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 bg-white dark:bg-slate-700 text-gray-700 dark:text-white transition-colors duration-200"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"To"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),t.jsx("input",{type:"date",value:v(n),onChange:e=>{e.target.value&&l(new Date(e.target.value))},max:m,min:v(s),className:"w-full p-2 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 bg-white dark:bg-slate-700 text-gray-700 dark:text-white transition-colors duration-200"})]})]})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Date range must be in the past. Today is ",u,"."]})]}):t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Date Range for Student"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"From"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),t.jsx("input",{type:"date",value:v(s),onChange:e=>{if(e.target.value){const t=new Date(e.target.value);i(t);new Date(n)<t&&l(t)}},max:m,className:"w-full p-2 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 bg-white dark:bg-slate-700 text-gray-700 dark:text-white transition-colors duration-200"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"To"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),t.jsx("input",{type:"date",value:v(n),onChange:e=>{e.target.value&&l(new Date(e.target.value))},max:m,min:v(s),className:"w-full p-2 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 bg-white dark:bg-slate-700 text-gray-700 dark:text-white transition-colors duration-200"})]})]})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Date range must be in the past. Today is ",u,"."]})]})},S=e=>{if(!e)return"";try{return n.fromJSDate(new Date(e)).toFormat("yyyy-MM-dd")}catch(t){return""}},A=()=>{const{theme:n}=d(),l={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{duration:.3}}},k=new Date;k.setDate(k.getDate()-1);const w=k,v=new Date(w);v.setDate(v.getDate()-7);const[A,T]=r.useState("daily"),[C,_]=r.useState(w),[E,M]=r.useState(v),[R,$]=r.useState(w),[I,L]=r.useState(""),[P,F]=r.useState([]),[H,O]=r.useState(!1),[W,Z]=r.useState(!1),[B,U]=r.useState(""),[J,z]=r.useState([]),[V,G]=r.useState(null);r.useEffect((()=>{"individual"===A&&e(void 0,null,(function*(){try{const e=yield b.getAllStudents();F(e.data.students||[])}catch(e){U("Failed to fetch students list")}}))}),[A]);const q=()=>{const e=new Date;if(e.setHours(0,0,0,0),"daily"===A){const t=new Date(C);return t.setHours(0,0,0,0),isNaN(t.getTime())?(i.error("Invalid date format"),!1):!(t>e)||(i.error("Selected date cannot be in the future"),!1)}const t=new Date(E),a=new Date(R);if(isNaN(t.getTime())||isNaN(a.getTime()))return i.error("Invalid date format"),!1;if(t.setHours(0,0,0,0),a.setHours(0,0,0,0),t>a)return i.error("Start date must be before end date"),!1;if(a>e)return i.error("End date cannot be in the future"),!1;if("weekly"===A){const e=Math.abs(a-t);if(Math.ceil(e/864e5)>31)return i.error("Weekly reports cannot span more than 31 days"),!1}if("monthly"===A){const e=Math.abs(a-t);if(Math.ceil(e/864e5)>31)return i.error("Monthly reports cannot span more than 31 days"),!1}return!("individual"===A&&!I)||(i.error("Please select a student for individual report"),!1)},K=()=>e(void 0,null,(function*(){if(q()){Z(!0),G(null),z(null);try{const e={"Preserve-MongoDB-Format":"true","MongoDB-Date-Format":"true","Content-Type":"application/json"};let t;const a=S(C),r=S(E),s=S(R);switch(A){case"daily":t=yield f.getDailyReportPreview({date:a},e);break;case"weekly":t=yield f.getWeeklyReportPreview({startDate:r,endDate:s},e);break;case"monthly":t=yield f.getMonthlyReportPreview({startDate:r,endDate:s},e);break;case"individual":if(!I)return G("Please select a student for individual report"),void Z(!1);if(!P.find((e=>e._id===I)))return G("Selected student not found in the database"),void Z(!1);t=yield f.getIndividualReportPreview({studentId:I,startDate:r,endDate:s},e);break;default:throw new Error(`Invalid report type: ${A}`)}if(!t.data)throw new Error("Invalid response format");z(t.data)}catch(e){G(e.message||"Failed to generate preview")}finally{Z(!1)}}else G("Invalid date range. Please select valid dates.")}));return t.jsx(a.div,{initial:"initial",animate:"animate",variants:{initial:{opacity:0},animate:{opacity:1,transition:{duration:.4,when:"beforeChildren",staggerChildren:.1}}},className:"py-6 dark:bg-slate-900 transition-colors duration-200",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[t.jsxs(a.div,{variants:l,className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full mr-3",children:t.jsx(m,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),t.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent dark:from-blue-400 dark:to-indigo-400",children:"Attendance Reports"})]}),t.jsx(a.button,{whileHover:{scale:W?1:1.05},whileTap:{scale:W?1:.95},onClick:K,disabled:W||"individual"===A&&!I,className:"flex items-center text-white px-4 py-2 rounded-md transition-colors "+(W||"individual"===A&&!I?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-blue-400 dark:to-indigo-500 hover:from-blue-600 hover:to-indigo-700 shadow-md"),children:W?t.jsxs(t.Fragment,{children:[t.jsxs(a.svg,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(c,{className:"h-4 w-4 mr-1"}),"Preview"]})})]}),t.jsxs(a.div,{variants:l,className:"bg-white dark:bg-slate-800 rounded-lg shadow-md overflow-hidden border border-gray-200 dark:border-slate-700",children:[t.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-slate-700",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:"Configure Report"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(a.div,{variants:l,children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Select Report Type"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(j,{icon:t.jsx(u,{className:"h-6 w-6"}),title:"Daily Attendance",description:"Student attendance for a specific day",isSelected:"daily"===A,onClick:()=>T("daily")}),t.jsx(j,{icon:t.jsx(x,{className:"h-6 w-6"}),title:"Weekly Attendance",description:"Attendance summary across a week",isSelected:"weekly"===A,onClick:()=>T("weekly")}),t.jsx(j,{icon:t.jsx(g,{className:"h-6 w-6"}),title:"Monthly Attendance",description:"Monthly attendance statistics",isSelected:"monthly"===A,onClick:()=>T("monthly")}),t.jsx(j,{icon:t.jsx(y,{className:"h-6 w-6"}),title:"Individual Student",description:"Detailed report for one student",isSelected:"individual"===A,onClick:()=>T("individual")})]})]}),t.jsx(a.div,{variants:l,children:t.jsx(D,{reportType:A,selectedDate:C,setSelectedDate:_,startDate:E,setStartDate:M,endDate:R,setEndDate:$})}),t.jsx(s,{children:"individual"===A&&t.jsxs(a.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Student"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(h,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),t.jsxs("select",{value:I,onChange:e=>L(e.target.value),className:"w-full p-2 border border-gray-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 transition-colors duration-200",children:[t.jsx("option",{value:"",children:"Select a student..."}),P.map((e=>t.jsxs("option",{value:e._id,children:[e.name," (",e.indexNumber,")"]},e._id)))]})]})]})}),t.jsx(s,{children:B&&t.jsxs(a.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/30 text-red-700 dark:text-red-300 px-4 py-3 rounded-md flex items-start",children:[t.jsx(o,{className:"h-5 w-5 mr-2 flex-shrink-0 mt-0.5 text-red-500 dark:text-red-400"}),t.jsx("span",{children:B})]})}),t.jsx(a.button,{whileHover:{scale:H||"individual"===A&&!I?1:1.02},whileTap:{scale:H||"individual"===A&&!I?1:.98},onClick:()=>e(void 0,null,(function*(){if(q()){O(!0),U(null);try{const e=S(C),t=S(E),a=S(R),r={"Preserve-MongoDB-Format":"true","MongoDB-Date-Format":"true","Content-Type":"application/json"};let s,d;switch(A){case"daily":s=yield f.generateReport("daily",{date:e},r),d=`daily_attendance_report_${e}.xlsx`;break;case"weekly":s=yield f.generateReport("weekly",{startDate:t,endDate:a},r),d=`weekly_attendance_report_${t}_to_${a}.xlsx`;break;case"monthly":s=yield f.generateReport("monthly",{startDate:t,endDate:a},r),d=`monthly_attendance_report_${t}_to_${a}.xlsx`;break;case"individual":if(!I)throw new Error("Please select a student for individual report");const i=P.find((e=>e._id===I));if(!i)throw new Error("Selected student not found");const n=i.name||i.indexNumber||"student";s=yield f.generateReport("individual",{studentId:I,startDate:t,endDate:a},r),d=`individual_attendance_report_${n}_${t}_to_${a}.xlsx`;break;default:throw new Error(`Invalid report type: ${A}`)}const n=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(n),o=document.createElement("a");o.href=l,o.download=d,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(l),document.body.removeChild(o),i.success(`Report generated successfully! Downloading ${d}`)}catch(e){i.error(e.message||"Failed to generate report"),U(e.message||"An error occurred while generating the report")}finally{O(!1)}}})),disabled:H||"individual"===A&&!I,className:"w-full py-3 px-4 rounded-md text-white font-medium flex items-center justify-center transition-all duration-200 "+(H||"individual"===A&&!I?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-md"),children:H?t.jsxs(t.Fragment,{children:[t.jsxs(a.svg,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(p,{className:"h-5 w-5 mr-2"}),"Generate Report"]})})]})]}),t.jsx("div",{className:"p-6",children:t.jsx(N,{reportType:A,previewData:J,loading:W,error:V,selectedDate:C})})]})]})})};export{A as default};
