var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,d=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(r)for(var a of r(t))n.call(t,a)&&i(e,a,t[a]);return e},l=(e,r)=>t(e,a(r));import{c as o,r as m,j as c,m as x}from"./vendor-niVxJDCj.js";import{B as u}from"./index-BuwQNYxn.js";import{Q as g}from"./index-Cap0JOW1.js";import{s as h}from"./studentService-GNYtZOwQ.js";import{i as b,I as y,A as p,n as f,k as j}from"./ui-DVJ2orZe.js";const v=()=>{const e=o(),[t,a]=m.useState(!1),[r,s]=m.useState(1),[n,i]=m.useState({name:"",indexNumber:"",address:"",student_email:"",parent_email:"",parent_telephone:"",age:0}),[v,N]=m.useState({}),[k,w]=m.useState({name:!1,indexNumber:!1,address:!1,student_email:!1,parent_email:!1,parent_telephone:!1,age:!1}),[_,S]=m.useState(""),[R,C]=m.useState(null);m.useEffect((()=>{_&&S("")}),[n,_]);const P=(e,t)=>{let a=d({},v);switch(e){case"name":t.trim()?t.trim().length<2?a.name="Name must be at least 2 characters":t.trim().length>50?a.name="Name must be less than 50 characters":/^[a-zA-Z\s'-]+$/.test(t)?delete a.name:a.name="Name can only contain letters, spaces, hyphens and apostrophes":a.name="Student name is required";break;case"indexNumber":t.trim()?t.trim().length<3?a.indexNumber="Index number must be at least 3 characters":t.trim().length>20?a.indexNumber="Index number must be less than 20 characters":delete a.indexNumber:a.indexNumber="Index number is required";break;case"student_email":t.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?delete a.student_email:a.student_email="Please enter a valid email address":a.student_email="Student email is required";break;case"parent_email":t.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?delete a.parent_email:a.parent_email="Please enter a valid email address":a.parent_email="Parent email is required";break;case"parent_telephone":if(t.trim()){const e=t.replace(/[\s-]/g,"");/^\+?\d{10,15}$/.test(e)?delete a.parent_telephone:a.parent_telephone="Phone number must be 10-15 digits with optional + prefix"}else a.parent_telephone="Parent telephone is required";break;case"age":null==t||""===t?a.age="Age is required":isNaN(t)||parseInt(t)<0||parseInt(t)>100?a.age="Age must be a number between 0 and 100":delete a.age}return N(a),!a[e]},I=e=>{const{name:t,value:a}=e.target;i((e=>l(d({},e),{[t]:a}))),k[t]&&P(t,a)},O=e=>{const{name:t}=e.target;w((e=>l(d({},e),{[t]:!0}))),P(t,n[t])},F=(e,t,a="text",r=!1,s="",i="")=>c.jsxs("div",{className:"col-span-1",children:[c.jsxs("label",{htmlFor:e,className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:[t," ",r&&c.jsx("span",{className:"text-red-500",children:"*"})]}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:a,name:e,id:e,required:r,placeholder:s,autoComplete:i,value:n[e],onChange:I,onBlur:O,className:"transition-all duration-200 shadow-sm block w-full sm:text-sm rounded-lg border p-2.5 "+(v[e]&&k[e]?"border-red-300 dark:border-red-600 text-red-900 dark:text-red-300 placeholder-red-300 dark:placeholder-red-500 focus:outline-none focus:ring-red-500 focus:border-red-500 dark:bg-gray-700":"border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-blue-500 focus:border-blue-500 hover:border-blue-400 dark:hover:border-blue-500")}),k[e]&&!v[e]&&c.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:c.jsx(j,{className:"h-5 w-5 text-green-500","aria-hidden":"true"})}),v[e]&&k[e]&&c.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:c.jsx(b,{className:"h-5 w-5 text-red-500","aria-hidden":"true"})})]}),v[e]&&k[e]?c.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v[e]}):c.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 h-4",children:"Â "})]}),q={initial:{opacity:0,x:"100%"},in:{opacity:1,x:0},out:{opacity:0,x:"-100%"}},A={type:"tween",duration:.3};return c.jsx("div",{className:"py-8 bg-gray-50 dark:bg-gray-900 min-h-screen",children:c.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[c.jsxs(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8 text-center",children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Student Registration"}),c.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:"Register a new student and generate their attendance QR code"})]}),c.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"mb-12",children:c.jsxs("div",{className:"flex items-center justify-center",children:[c.jsxs("div",{className:"flex items-center relative",children:[c.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 "+(r>=1?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300"),children:"1"}),c.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 absolute -bottom-7 w-24 text-center",children:"Student Info"})]}),c.jsx("div",{className:"h-1 w-32 transition-all duration-500 "+(r>=2?"bg-blue-600":"bg-gray-200 dark:bg-gray-700")}),c.jsxs("div",{className:"flex items-center relative",children:[c.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 "+(r>=2?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300"),children:"2"}),c.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 absolute -bottom-7 w-24 text-center",children:"QR Code"})]})]})}),_&&c.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"mb-6 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 dark:border-red-600 p-4 rounded-md shadow-sm",children:c.jsxs("div",{className:"flex",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx(b,{className:"h-5 w-5 text-red-400 dark:text-red-500","aria-hidden":"true"})}),c.jsx("div",{className:"ml-3",children:c.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:_})})]})}),c.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden border border-gray-100 dark:border-gray-700",children:1===r?c.jsx(x.div,{initial:"initial",animate:"in",exit:"out",variants:q,transition:A,className:"px-6 py-8 sm:p-8",children:c.jsxs("form",{onSubmit:e=>{return t=void 0,r=null,i=function*(){var t,r;e.preventDefault();const i={};if(Object.keys(n).forEach((e=>{i[e]=!0})),w(i),(()=>{let e={};for(const t in n)P(t,n[t])||(e[t]=v[t]);return N(e),0===Object.keys(e).length})())try{a(!0),S("");const e=yield h.registerStudent(n);u.success("Student registered successfully"),C(e.data.student||n),s(2)}catch(d){const e=(null==(r=null==(t=d.response)?void 0:t.data)?void 0:r.message)||"Failed to register student. Please try again.";S(e),u.error(e)}finally{a(!1)}else u.error("Please fix the errors in the form before submitting")},new Promise(((a,s)=>{var n=t=>{try{l(i.next(t))}catch(e){s(e)}},d=t=>{try{l(i.throw(t))}catch(e){s(e)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,d);l((i=i.apply(t,r)).next())}));var t,r,i},className:"space-y-8",children:[c.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4 mb-6",children:[c.jsx("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Personal Information"}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Enter the student's basic information"})]}),c.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-6 sm:grid-cols-2",children:[F("name","Full Name","text",!0,"John Doe"),F("indexNumber","Index Number","text",!0,"S12345"),F("student_email","Student Email","email",!0,"student@example.com","email"),F("address","Address","text",!1,"123 Street, City","street-address")]}),c.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4 mb-6",children:[c.jsx("h2",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:"Parent/Guardian Information"}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Enter parent or guardian contact details"})]}),c.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-6 sm:grid-cols-2",children:[F("parent_email","Parent Email","email",!0,"parent@example.com","email"),F("parent_telephone","Parent Telephone","tel",!0,"+94XXXXXXXXXX","tel"),F("age","Age","number",!0,"")]}),c.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700",children:[c.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[c.jsx(y,{className:"h-5 w-5 text-blue-500 dark:text-blue-400 mr-2"}),c.jsxs("span",{children:["Fields marked with ",c.jsx("span",{className:"text-red-500",children:"*"})," ","are required"]})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsxs(x.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"button",onClick:()=>e("/students"),className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-200",children:[c.jsx(p,{className:"h-4 w-4 mr-1.5"}),"Cancel"]}),c.jsx(x.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:t||Object.keys(v).length>0,className:"inline-flex items-center px-5 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white transition-all duration-200 "+(t||Object.keys(v).length>0?"bg-blue-300 dark:bg-blue-400/50 cursor-not-allowed":"bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800"),children:t?c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[c.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),c.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Registering..."]}):c.jsxs(c.Fragment,{children:["Register Student",c.jsx(f,{className:"h-4 w-4 ml-1.5"})]})})]})]})]})}):c.jsxs(x.div,{initial:"initial",animate:"in",exit:"out",variants:q,transition:A,className:"px-6 py-8 sm:p-8",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx(x.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mx-auto w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-4",children:c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-green-600 dark:text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:c.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),c.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-2",children:"Registration Successful!"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Student has been registered successfully. You can now download their QR code."})]}),c.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-8",children:[c.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"flex-1",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Student Information"}),c.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-5 border border-gray-100 dark:border-gray-600 shadow-sm",children:c.jsxs("dl",{className:"grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Name"}),c.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white font-medium",children:(null==R?void 0:R.name)||n.name})]}),c.jsxs("div",{children:[c.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Index Number"}),c.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white font-medium",children:(null==R?void 0:R.indexNumber)||n.indexNumber})]}),c.jsxs("div",{children:[c.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Email"}),c.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white font-medium",children:(null==R?void 0:R.student_email)||n.student_email})]}),c.jsxs("div",{children:[c.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Address"}),c.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white font-medium",children:(null==R?void 0:R.address)||n.address})]}),c.jsxs("div",{children:[c.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Age"}),c.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white font-medium",children:(null==R?void 0:R.age)||n.age})]}),c.jsxs("div",{children:[c.jsx("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Registration Date"}),c.jsx("dd",{className:"mt-1 text-sm text-gray-900 dark:text-white font-medium",children:(new Date).toLocaleDateString()})]})]})})]}),c.jsxs(x.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},className:"flex flex-col items-center",children:[c.jsx("div",{className:"p-6 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-sm mb-4",children:c.jsx(g,{id:"student-qr-code",value:(()=>{const e={name:(null==R?void 0:R.name)||n.name,indexNumber:(null==R?void 0:R.indexNumber)||n.indexNumber,student_email:(null==R?void 0:R.student_email)||n.student_email,address:(null==R?void 0:R.address)||n.address};return JSON.stringify(e)})(),size:220,level:"H",includeMargin:!0,bgColor:"#FFFFFF",fgColor:"#000000"})}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs text-center mb-5",children:"This QR code contains the student's information and can be used for attendance tracking."}),c.jsxs(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{try{const e=document.getElementById("student-qr-code");if(!e)return void u.error("QR code canvas not found. Please try again.");const t=e.toDataURL("image/png"),a=document.createElement("a");a.href=t,a.download=`qrcode-${(null==R?void 0:R.indexNumber)||n.indexNumber}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a),u.success("QR Code downloaded successfully")}catch(e){u.error("Failed to download QR code. Please try again.")}},className:"inline-flex items-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-200 w-full justify-center",children:[c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:c.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Download QR Code"]})]})]}),c.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"mt-10 pt-6 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[c.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[c.jsx(y,{className:"h-5 w-5 text-blue-500 dark:text-blue-400 inline mr-1"}),"You can share this QR code with the student for attendance marking."]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsxs(x.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"button",onClick:()=>e("/students"),className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-200",children:[c.jsx(p,{className:"h-4 w-4 mr-1.5"}),"Back to Students"]}),c.jsxs(x.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"button",onClick:()=>{i({name:"",indexNumber:"",address:"",student_email:"",parent_email:"",parent_telephone:"",age:0}),C(null),N({}),w({name:!1,indexNumber:!1,address:!1,student_email:!1,parent_email:!1,parent_telephone:!1,age:!1}),S(""),s(1)},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-200",children:["Register Another",c.jsx(f,{className:"h-4 w-4 ml-1.5"})]})]})]})]})})]})})};export{v as default};
